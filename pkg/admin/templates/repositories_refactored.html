{{/* é‡æ„åçš„ä»“åº“ç®¡ç†æ¨¡æ¿ - repositories_refactored.html */}}
{{define "repositories_refactored"}}
{{template "layout" .}}

{{/* è‡ªå®šä¹‰é¡µé¢æ ‡é¢˜ */}}
{{define "title"}}ä»“åº“ç®¡ç† - Athensä»“åº“ç®¡ç†ç³»ç»Ÿ{{end}}

{{/* åŒ…å«ä»“åº“ç®¡ç†ç‰¹å®šæ ·å¼ */}}
{{define "page-styles"}}
{{template "repository-styles" .}}
{{end}}

{{/* åŒ…å«ä¾§è¾¹æ  */}}
{{define "sidebar"}}
{{template "sidebar" .}}
{{end}}

{{/* ä¸»è¦å†…å®¹åŒºåŸŸ */}}
{{define "content"}}
<div class="content-header">
    <div class="content-title">ä»“åº“ç®¡ç†</div>
    <div class="breadcrumb">
        <a href="/admin/dashboard">é¦–é¡µ</a> &gt; ä»“åº“ç®¡ç†
    </div>
</div>

<!-- æœç´¢å’Œè¿‡æ»¤å™¨ -->
<div class="filter-bar">
    <input type="text" class="search-input" placeholder="æœç´¢æ¨¡å—åç§°..." id="searchInput">
    <select class="filter-select" id="typeFilter">
        <option value="all">æ‰€æœ‰ç±»å‹</option>
        <option value="public">å…¬å…±æ¨¡å—</option>
        <option value="private">ç§æœ‰æ¨¡å—</option>
    </select>
    <select class="filter-select" id="statusFilter">
        <option value="all">æ‰€æœ‰çŠ¶æ€</option>
        <option value="active">æ´»è·ƒ</option>
        <option value="inactive">éæ´»è·ƒ</option>
    </select>
    <button class="filter-button" onclick="applyFilters()">æœç´¢</button>
    <a href="/admin/repositories/add" class="filter-button">æ·»åŠ æ–°æ¨¡å—</a>
</div>

<!-- ä»“åº“åˆ—è¡¨ -->
{{if .Repositories}}
<div class="repository-grid">
    {{range .Repositories}}
    <div class="repository-card">
        <div class="repository-header">
            <h3 class="repository-name">{{.Name}}</h3>
            <span class="repository-status {{if eq .Type "public"}}status-public{{else}}status-private{{end}}">
                {{.Type}}
            </span>
        </div>
        
        <div class="repository-description">
            {{.Description | default "æš‚æ— æè¿°"}}
        </div>
        
        <div class="repository-meta">
            <span>ç‰ˆæœ¬: <span class="repository-version">{{.Version}}</span></span>
            <span>æ›´æ–°: {{.UpdatedAt}}</span>
        </div>
        
        <div class="repository-actions">
            <a href="/admin/repositories/{{.ID}}" class="action-button primary">æŸ¥çœ‹è¯¦æƒ…</a>
            <a href="/admin/repositories/{{.ID}}/edit" class="action-button">ç¼–è¾‘</a>
            <a href="/admin/repositories/{{.ID}}/download" class="action-button">ä¸‹è½½</a>
        </div>
    </div>
    {{end}}
</div>

<!-- åˆ†é¡µ -->
{{if .Pagination}}
<div class="pagination">
    {{if .Pagination.HasPrev}}
        <a href="?page={{.Pagination.PrevPage}}" class="pagination-button">&laquo; ä¸Šä¸€é¡µ</a>
    {{else}}
        <span class="pagination-button disabled">&laquo; ä¸Šä¸€é¡µ</span>
    {{end}}
    
    {{range .Pagination.Pages}}
        {{if eq . $.Pagination.CurrentPage}}
            <span class="pagination-button active">{{.}}</span>
        {{else}}
            <a href="?page={{.}}" class="pagination-button">{{.}}</a>
        {{end}}
    {{end}}
    
    {{if .Pagination.HasNext}}
        <a href="?page={{.Pagination.NextPage}}" class="pagination-button">ä¸‹ä¸€é¡µ &raquo;</a>
    {{else}}
        <span class="pagination-button disabled">ä¸‹ä¸€é¡µ &raquo;</span>
    {{end}}
</div>
{{end}}

{{else}}
<!-- ç©ºçŠ¶æ€ -->
<div class="empty-state">
    <div class="empty-state-icon">ğŸ“¦</div>
    <div class="empty-state-title">æš‚æ— ä»“åº“</div>
    <div class="empty-state-description">è¿˜æ²¡æœ‰ä»»ä½•Goæ¨¡å—ä»“åº“ï¼Œç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æ·»åŠ ç¬¬ä¸€ä¸ªæ¨¡å—ã€‚</div>
    <a href="/admin/repositories/add" class="button">æ·»åŠ æ–°æ¨¡å—</a>
</div>
{{end}}
{{end}}

{{/* è‡ªå®šä¹‰è„šæœ¬ */}}
{{define "scripts"}}
<script>
// æœç´¢å’Œè¿‡æ»¤åŠŸèƒ½
function applyFilters() {
    const searchTerm = document.getElementById('searchInput').value;
    const typeFilter = document.getElementById('typeFilter').value;
    const statusFilter = document.getElementById('statusFilter').value;
    
    const params = new URLSearchParams();
    if (searchTerm) params.append('search', searchTerm);
    if (typeFilter !== 'all') params.append('type', typeFilter);
    if (statusFilter !== 'all') params.append('status', statusFilter);
    
    window.location.href = '/admin/repositories?' + params.toString();
}

// å›è½¦é”®æœç´¢
document.getElementById('searchInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        applyFilters();
    }
});

// é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    console.log('ä»“åº“ç®¡ç†é¡µé¢å·²åŠ è½½');
    
    // ä»URLå‚æ•°ä¸­æ¢å¤è¿‡æ»¤å™¨çŠ¶æ€
    const urlParams = new URLSearchParams(window.location.search);
    const searchTerm = urlParams.get('search');
    const typeFilter = urlParams.get('type');
    const statusFilter = urlParams.get('status');
    
    if (searchTerm) document.getElementById('searchInput').value = searchTerm;
    if (typeFilter) document.getElementById('typeFilter').value = typeFilter;
    if (statusFilter) document.getElementById('statusFilter').value = statusFilter;
});
</script>
{{end}}
{{end}}